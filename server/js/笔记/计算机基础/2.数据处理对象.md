# [详解 FormData 、Blob、File、FileReader、ArrayBuffer、URL、URLSearchParams 对象](https://www.jianshu.com/p/67702e025ede)

Blob(binary large object)、ArrayBuffer、File 可以归为一类，它们都是数据；

FileReader 算是一种工具，用来读取数据；

FormData 可以看做是一个应用数据的场景。

# [Javascript 中的二进制数据](https://zhangkai.pro/2020/09/09/binary-data-in-javascript)

![Javascript 中的二进制数据](../../imgs/binary-data-in-javascript.png)

#

1. ArrayBuffer，二进制数组
2. Blob
3. File 和 FileReader

## 关系

File 就是 Blob 里面的一个小类，继承 Blob 的方法和属性

## atob 和 btoa

1. atob 表示 Base64 字符 to 普通字符，也就是 Base64 解码。(b 即 binary，二进制数据)

2. btoa 反之，表示 base64 编码。

## URL.createObjectURL()与 FileReader.readAsDataURL()

```js
// createObjectURL：获取指向当前文件的内存url
```

```js
// readAsDataURL：获取base64编码的字符串数据
// FileReader将文件读入内存，并读取文件中的数据。FileReader提供了异步api，可以在浏览器主线程中异步访问文件系统，读取文件中的数据。
// FileReader的result有三种形式，取决于调用读取的方法

const maxSize = 2 * 1024 * 1024; // 2M
const maxWidth = 1080;
const maxHeight = 1080;

function compress(base64) {
  // 通过img在canvas绘制压缩图片
    const img = new Image();
    img.onload = () => {

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      const iw = img.width;
      const ih = img.height;

    };
    img.src = base64;
}

function readFile() {
  const reader = new FileReader();
  reader.onload = (e) => {
    const src = e.target.result; // base64数据    
    compress(src);
  };
  reader.readAsDataURL(file); // 读取file文件
}
```

## 运用

```js
// 将canvas转为base64 toDataURL
```

```js
//将base64转换为blob
dataURLtoBlob: function (dataurl) {
  var arr = dataurl.split(',');
  let mime = arr[0].match(/:(.*?);/)[1];
  let bstr = atob(arr[1]);
  let n = bstr.length;
  let u8arr = new Uint8Array(n);
  while (n--) {
    u8arr[n] = bstr.charCodeAt(n);
  }
  return new Blob([u8arr], {type: mime});
  // return new File([u8arr], "imgName.jpg", {type:mime}); // ie不支持File对象，只有这一行有差异
},
```

```js
// Blob下载到本地
function saveShareContent(content, fileName) {
  let downLink = document.createElement("a");
  downLink.download = fileName;
  //字符内容转换为blod地址
  let blob = new Blob([content]);
  downLink.href = URL.createObjectURL(blob);
  // 链接插入到页面
  document.body.appendChild(downLink);
  downLink.click();
  // 移除下载链接
  document.body.removeChild(downLink);
}
```

```js
//将blob转换为文件，blob比file少了两个属性
blobToFile: function (theBlob, fileName) {
  theBlob.lastModifiedDate = new Date();
  theBlob.name = fileName;
  return theBlob;
}
```
